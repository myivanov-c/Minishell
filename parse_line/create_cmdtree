/* ************************************************************************** */
/*                                                                            */
/*                                                        :::      ::::::::   */
/*   create_cmdtree                                     :+:      :+:    :+:   */
/*                                                    +:+ +:+         +:+     */
/*   By: mykytaivanov <mykytaivanov@student.42.f    +#+  +:+       +#+        */
/*                                                +#+#+#+#+#+   +#+           */
/*   Created: 2025/11/04 14:44:51 by mykytaivano       #+#    #+#             */
/*   Updated: 2025/11/04 15:05:17 by mykytaivano      ###   ########.fr       */
/*                                                                            */
/* ************************************************************************** */


#include "../minishell.h"
#include "parse_line.h"

t_cmdtree	*cmdtree_new_node(t_list *tokens);
t_cmdtree	*cmdtree_expand(t_cmdtree *cmdtree);

t_cmdtree	*create_cmdtree(t_list *tokens)
{
	t_list		*duptokens;
	t_cmdtree	*cmdtree;
	int			return_check;

	duptokens = ft_lstmap(tokens, dup_token, free_token);
	if (!duptokens)
		return (NULL);
	cmdtree = cmdtree_new_node(duptokens);
	if (!cmdtree)
		return (ft_lstclear(duptokens, free_token), NULL);
	return_check = cmdtree_expand(cmdtree);
	if (return_check == -1)
		return (cmdtree_clear(cmdtree), NULL);
	return (cmdtree);
}

t_cmdtree	*cmdtree_new_node(t_list *tokens)
{
	t_cmdtree	*node;

	if (!tokens)
		return (NULL);
	node = malloc(sizeof(t_cmdtree));
	if (!node)
		return (NULL);
	node->tokens = tokens;
	node->type = -1;
	//node->input = -1;
	//node->output = -1;
	node->exit_status = 0;
	node->exec_status = 0;
	node->parent = NULL;
	node->child1 = NULL;
	node->child2 = NULL;
	node->cmd = NULL;
	return (node);
}

t_cmdtree	*cmdtree_expand(t_cmdtree *cmdtree)
{
	cmdtree->type = cmdtree_calc_type(cmdtree);
	if (cmdtree->type == 0)
	{
	}
	if (cmdtree->type == 1
		|| cmdtree->type == 2
		|| cmdtree->type == 3)
	{
		int i = getloc();
		cmdtree->child1 = cmdtree_new_node(cmdtree->tokens);
		cmdtree->child1->parent = cmdtree;
		cmdtree->child2 = cmdtree_new_node(cmdtree->tokens);
		cmdtree->child2->parent = cmdtree;
	}
	if (cmdtree->type == 4)
	{
	}
	if (cmdtree->child1)
		cmdtree_expand(cmdtree->child1);
	if (cmdtree->child2)
		cmdtree_expand(cmdtree->child2);
}